{
  "version": 3,
  "sources": ["../../filepond-plugin-file-encode/dist/filepond-plugin-file-encode.esm.js"],
  "sourcesContent": ["/*!\r\n * FilePondPluginFileEncode 2.1.14\r\n * Licensed under MIT, https://opensource.org/licenses/MIT/\r\n * Please visit https://pqina.nl/filepond/ for details.\r\n */\r\n\r\n/* eslint-disable */\r\n\r\nconst DataURIWorker = function() {\r\n    // route messages\r\n    self.onmessage = e => {\r\n        convert(e.data.message, response => {\r\n            self.postMessage({ id: e.data.id, message: response });\r\n        });\r\n    };\r\n\r\n    // convert file to data uri\r\n    const convert = (options, cb) => {\r\n        const { file } = options;\r\n\r\n        const reader = new FileReader();\r\n        reader.onloadend = () => {\r\n            cb(reader.result.replace('data:', '').replace(/^.+,/, ''));\r\n        };\r\n        reader.readAsDataURL(file);\r\n    };\r\n};\r\n\r\nconst plugin = ({ addFilter, utils }) => {\r\n    // get quick reference to Type utils\r\n    const { Type, createWorker, createRoute, isFile } = utils;\r\n\r\n    const encode = ({ name, file }) =>\r\n        new Promise(resolve => {\r\n            const worker = createWorker(DataURIWorker);\r\n            worker.post({ file }, data => {\r\n                resolve({ name, data });\r\n                worker.terminate();\r\n            });\r\n        });\r\n\r\n    // holds base64 strings till can be moved to item\r\n    const base64Cache = [];\r\n    addFilter('DID_CREATE_ITEM', (item, { query }) => {\r\n        if (!query('GET_ALLOW_FILE_ENCODE')) return;\r\n\r\n        item.extend(\r\n            'getFileEncodeBase64String',\r\n            () => base64Cache[item.id] && base64Cache[item.id].data\r\n        );\r\n        item.extend(\r\n            'getFileEncodeDataURL',\r\n            () =>\r\n                base64Cache[item.id] && `data:${item.fileType};base64,${base64Cache[item.id].data}`\r\n        );\r\n    });\r\n\r\n    addFilter(\r\n        'SHOULD_PREPARE_OUTPUT',\r\n        (shouldPrepareOutput, { query }) =>\r\n            new Promise(resolve => {\r\n                resolve(query('GET_ALLOW_FILE_ENCODE'));\r\n            })\r\n    );\r\n\r\n    addFilter(\r\n        'COMPLETE_PREPARE_OUTPUT',\r\n        (file, { item, query }) =>\r\n            new Promise(resolve => {\r\n                // if it's not a file or a list of files, continue\r\n                if (!query('GET_ALLOW_FILE_ENCODE') || (!isFile(file) && !Array.isArray(file))) {\r\n                    return resolve(file);\r\n                }\r\n\r\n                // store metadata settings for this cache\r\n                base64Cache[item.id] = {\r\n                    metadata: item.getMetadata(),\r\n                    data: null,\r\n                };\r\n\r\n                // wait for all file items to be encoded\r\n                Promise.all(\r\n                    (file instanceof Blob ? [{ name: null, file }] : file).map(encode)\r\n                ).then(dataItems => {\r\n                    base64Cache[item.id].data =\r\n                        file instanceof Blob ? dataItems[0].data : dataItems;\r\n                    resolve(file);\r\n                });\r\n            })\r\n    );\r\n\r\n    // called for each view that is created right after the 'create' method\r\n    addFilter('CREATE_VIEW', viewAPI => {\r\n        // get reference to created view\r\n        const { is, view, query } = viewAPI;\r\n\r\n        // only hook up to item view\r\n        if (!is('file-wrapper') || !query('GET_ALLOW_FILE_ENCODE')) {\r\n            return;\r\n        }\r\n\r\n        view.registerWriter(\r\n            createRoute({\r\n                DID_PREPARE_OUTPUT: ({ root, action }) => {\r\n                    // only do this if is not uploading async\r\n                    if (query('IS_ASYNC')) {\r\n                        return;\r\n                    }\r\n\r\n                    const item = query('GET_ITEM', action.id);\r\n                    if (!item) return;\r\n\r\n                    // extract base64 string\r\n                    const cache = base64Cache[item.id];\r\n                    const metadata = cache.metadata;\r\n                    const data = cache.data;\r\n\r\n                    // create JSON string from encoded data\r\n                    const value = JSON.stringify({\r\n                        id: item.id,\r\n                        name: item.file.name,\r\n                        type: item.file.type,\r\n                        size: item.file.size,\r\n                        metadata: metadata,\r\n                        data,\r\n                    });\r\n\r\n                    // for filepond < 4.13.0\r\n                    if (root.ref.data) {\r\n                        root.ref.data.value = value;\r\n                    }\r\n                    // newer versions\r\n                    else {\r\n                        root.dispatch('DID_DEFINE_VALUE', {\r\n                            id: item.id,\r\n                            value,\r\n                        });\r\n                    }\r\n                },\r\n                DID_REMOVE_ITEM: ({ action }) => {\r\n                    const item = query('GET_ITEM', action.id);\r\n                    if (!item) return;\r\n                    delete base64Cache[item.id];\r\n                },\r\n            })\r\n        );\r\n    });\r\n\r\n    return {\r\n        options: {\r\n            // Enable or disable file encoding\r\n            allowFileEncode: [true, Type.BOOLEAN],\r\n        },\r\n    };\r\n};\r\n\r\n// fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\r\nconst isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\r\nif (isBrowser) {\r\n    document.dispatchEvent(new CustomEvent('FilePond:pluginloaded', { detail: plugin }));\r\n}\r\n\r\nexport default plugin;\r\n"],
  "mappings": "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",
  "names": []
}
